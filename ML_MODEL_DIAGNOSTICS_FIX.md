# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–∏–∑–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é Triple Ensemble

## üìä –ü–†–û–ë–õ–ï–ú–ê

–ú–æ–¥–µ–ª—å `triple_ensemble_ETHUSDT_15.pkl` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è LONG/SHORT, –Ω–æ —Å –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é:
- **LONG**: —Å—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å 14.74% (–Ω—É–∂–Ω–æ ‚â•40%)
- **SHORT**: —Å—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å 13.83% (–Ω—É–∂–Ω–æ ‚â•40%)
- **HOLD**: —Å—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å 48.20%

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–µ—Ç actionable —Å–∏–≥–Ω–∞–ª–æ–≤ (0 –∏–∑ 50 –±–∞—Ä–æ–≤)

---

## üîç –ü–†–ò–ß–ò–ù–´

### 1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –∞–Ω—Å–∞–º–±–ª—è**

–î–ª—è `TripleEnsemble` –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏, —á—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –∞–Ω—Å–∞–º–±–ª—è. –ù–æ —Ç–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è LONG/SHORT.

### 2. **–°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ –ø–æ—Ä–æ–≥–∏**

–¢–µ–∫—É—â–∏–µ –ø–æ—Ä–æ–≥–∏:
- `confidence_threshold`: 0.5 (50%)
- `min_strength_threshold`: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `min_signal_strength` (–æ–±—ã—á–Ω–æ 0.6-0.7)
- `effective_threshold`: 70-85% –æ—Ç `confidence_threshold`

–î–ª—è –∞–Ω—Å–∞–º–±–ª—è —ç—Ç–æ —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–æ.

### 3. **–õ–æ–≥–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è**

–í `predict()` –º–µ—Ç–æ–¥ –±–µ—Ä–µ—Ç –∫–ª–∞—Å—Å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é, –Ω–æ –¥–ª—è –∞–Ω—Å–∞–º–±–ª—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π.

---

## ‚úÖ –†–ï–®–ï–ù–ò–Ø

### –†–µ—à–µ–Ω–∏–µ 1: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –∞–Ω—Å–∞–º–±–ª–µ–π (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –º—è–≥–∫–∏–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –∞–Ω—Å–∞–º–±–ª–µ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π:

```python
# –í generate_signal()
if self.is_ensemble:
    # –î–ª—è –∞–Ω—Å–∞–º–±–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –º—è–≥–∫–∏–µ –ø–æ—Ä–æ–≥–∏
    ensemble_threshold_multiplier = 0.5  # –°–Ω–∏–∂–∞–µ–º –ø–æ—Ä–æ–≥ –≤ 2 —Ä–∞–∑–∞
    effective_threshold = max(
        self.confidence_threshold * ensemble_threshold_multiplier,
        min_strength * 0.5  # –¢–∞–∫–∂–µ —Å–Ω–∏–∂–∞–µ–º min_strength
    )
else:
    # –î–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä–æ–≥–∏
    effective_threshold = max(dynamic_threshold * threshold_mult, min_strength)
```

### –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –≤–º–µ—Å—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

–í–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É LONG/SHORT –∏ HOLD:

```python
# –í predict() –∏–ª–∏ generate_signal()
if prediction == 1:  # LONG
    long_prob = probabilities[2]  # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å LONG
    hold_prob = probabilities[1]  # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å HOLD
    # –ï—Å–ª–∏ LONG –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤—ã—à–µ HOLD (–º–∏–Ω–∏–º—É–º –Ω–∞ 5%), –ø—Ä–∏–Ω–∏–º–∞–µ–º —Å–∏–≥–Ω–∞–ª
    if long_prob > hold_prob * 1.05:  # LONG –Ω–∞ 5% –≤—ã—à–µ HOLD
        # –ü—Ä–∏–Ω–∏–º–∞–µ–º —Å–∏–≥–Ω–∞–ª
        pass
```

### –†–µ—à–µ–Ω–∏–µ 3: –°–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥–∏ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π

–ü—Ä–æ—Å—Ç–æ —Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö:
- `confidence_threshold`: 0.5 ‚Üí 0.3 (30%)
- `min_signal_strength`: "—É–º–µ—Ä–µ–Ω–Ω–æ–µ" ‚Üí "—Å–ª–∞–±–æ–µ"

---

## üõ†Ô∏è –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### –í–∞—Ä–∏–∞–Ω—Ç A: –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥–∏)

–í `config.py` –∏–ª–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
```python
ml_confidence_threshold: 0.3  # –ë—ã–ª–æ 0.5
ml_min_signal_strength: "—Å–ª–∞–±–æ–µ"  # –ë—ã–ª–æ "—É–º–µ—Ä–µ–Ω–Ω–æ–µ"
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –∞–Ω—Å–∞–º–±–ª–µ–π (–ª—É—á—à–µ)

–û–±–Ω–æ–≤–∏—Ç—å `bot/ml/strategy_ml.py`:

```python
# –í –º–µ—Ç–æ–¥–µ generate_signal(), –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 467
prediction, confidence = self.predict(df, skip_feature_creation=True)

# –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –∞–Ω—Å–∞–º–±–ª–µ–π
if self.is_ensemble:
    # –î–ª—è –∞–Ω—Å–∞–º–±–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –º—è–≥–∫–∏–µ –ø–æ—Ä–æ–≥–∏
    # –ê–Ω—Å–∞–º–±–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
    ensemble_threshold_multiplier = 0.4  # –°–Ω–∏–∂–∞–µ–º –ø–æ—Ä–æ–≥ –¥–æ 40%
    min_strength_multiplier = 0.3  # –°–Ω–∏–∂–∞–µ–º min_strength –¥–æ 30%
    
    # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä–æ–≥–∏
    if is_volatile_symbol:
        min_strength = self.min_strength_threshold * min_strength_multiplier * 0.5
    else:
        min_strength = self.min_strength_threshold * min_strength_multiplier
    
    # –î–ª—è –∞–Ω—Å–∞–º–±–ª–µ–π —Ç–∞–∫–∂–µ —Å–Ω–∏–∂–∞–µ–º confidence_threshold
    effective_confidence_threshold = self.confidence_threshold * ensemble_threshold_multiplier
else:
    # –î–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä–æ–≥–∏
    effective_confidence_threshold = self.confidence_threshold
    if is_volatile_symbol:
        min_strength = self.min_strength_threshold * 0.3
    else:
        min_strength = self.min_strength_threshold
```

### –í–∞—Ä–∏–∞–Ω—Ç C: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)

–û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è:

```python
# –í –º–µ—Ç–æ–¥–µ predict(), –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è proba
if self.is_ensemble:
    long_prob = proba[2] if len(proba) > 2 else 0.0
    short_prob = proba[0] if len(proba) > 0 else 0.0
    hold_prob = proba[1] if len(proba) > 1 else 0.0
    
    # –î–ª—è –∞–Ω—Å–∞–º–±–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
    # –ï—Å–ª–∏ LONG/SHORT –≤—ã—à–µ HOLD –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç, –ø—Ä–∏–Ω–∏–º–∞–µ–º
    if long_prob > hold_prob * 1.1:  # LONG –Ω–∞ 10% –≤—ã—à–µ HOLD
        prediction = 1
        confidence = long_prob
    elif short_prob > hold_prob * 1.1:  # SHORT –Ω–∞ 10% –≤—ã—à–µ HOLD
        prediction = -1
        confidence = short_prob
    else:
        prediction = 0
        confidence = hold_prob
```

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç B (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏)** + **–í–∞—Ä–∏–∞–Ω—Ç C (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å)**:

1. –î–ª—è –∞–Ω—Å–∞–º–±–ª–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –º—è–≥–∫–∏–µ –ø–æ—Ä–æ–≥–∏
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (LONG/SHORT vs HOLD)
3. –≠—Ç–æ –¥–∞—Å—Ç –±–æ–ª—å—à–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- **–ë–æ–ª—å—à–µ actionable —Å–∏–≥–Ω–∞–ª–æ–≤**: 10-20 –∏–∑ 50 –±–∞—Ä–æ–≤ (–≤–º–µ—Å—Ç–æ 0)
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞**: —Å–∏–≥–Ω–∞–ª—ã –≤—Å–µ –µ—â–µ –±—É–¥—É—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –¥—Ä—É–≥–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
- **–õ—É—á—à–∞—è —Ä–∞–±–æ—Ç–∞ –∞–Ω—Å–∞–º–±–ª–µ–π**: –∞–Ω—Å–∞–º–±–ª–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –º–æ–¥–µ–ª–∏
python -m bot.ml.diagnose_model ml_models/triple_ensemble_ETHUSDT_15.pkl

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# - –ë–æ–ª—å—à–µ actionable —Å–∏–≥–Ω–∞–ª–æ–≤ (10-20 –≤–º–µ—Å—Ç–æ 0)
# - –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å LONG/SHORT: 15-25% (–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è –∞–Ω—Å–∞–º–±–ª–µ–π)
# - –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É LONG/SHORT –∏ HOLD: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è
```
